---
title: "RSA ASM EMG"
author: "Alina Koppold, Carlos Ventura-Bort"
date: "2023-09-10"
output: html_document
editor_options: 
  chunk_output_type: console
---
  
``` {r,include=FALSE}
#Adapt path accordingly
#load funcitons
rm(list = ls())
source ('./scripts/final_EMG_analysis_beforePresentation/RSAFunctions_only150923.R') 
#Variable to load data and avoid redoing all analysis. 
loadData<-1
if (loadData==1){
  load("./data/allData_proofed.Rdata") 
  load("./data/df_rat.Rdata") 
  loadData<-1
}
#Set the wd
#setwd("C:/Users/cvent/Desktop/RESEARCH/RSA_LondorfLab")
```


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


``` {r,include=FALSE}
#######
##Libraries
library(base)
library(psycho)
library(tidyverse)
library(dplyr)
library(ggplot2)
library(fs)
library (lme4)
library(lmerTest)
library(sjPlot)
library(rstatix)
library(Hmisc)
# install.packages("extrafont")
library(extrafont)
library (ggbeeswarm)
library(BayesFactor)
library(bayestestR)
library(glue)
library(viridis)
library(ggpubr)
library(ggExtra)
#################################################
### Load Fonts for figures
#################################################
loadfonts(device="win")       #Register fonts for Windows bitmap output
#windowsFonts(Times=windowsFont("Times"))
```

```{r data-wrangling}
emg$ID = sub('.*(\\d{3}).*', '\\1', emg$Subject)
emg_sub =emg %>% select(Subject, ID, project, Stimulus,TAmplitudes,NumberOfTimesPresented, StimulusNumber) %>% unique() # to be added  Q_LTE_di, Q_CTQ_di, Q_STAIT_sum, Q_BDI_sum
emg_sub$picNum<-str_sub(emg_sub$Stimulus,11,-1L)
emg_sub$Stimulus = NULL
emg_sub$ID = gsub("[^0-9.-]", "",emg_sub$ID)
emg_sub$ID = gsub("^0", "", emg_sub$ID) 
emg_sub$ID = gsub("^0", "", emg_sub$ID) 

# prep df_rat
df_rat$picNum<-str_sub(df_rat$picture,1,6)
df_rat$picture = NULL
df_rat_emg = merge(emg_sub, df_rat, by = c("ID", "project", "picNum"))
#detach(package:plyr) # if "sanity" is empty
sanity = df_rat_emg %>% group_by(Subject) %>% tally()

dfEMG<-df_rat_emg%>%select(ID,project, picNum,TAmplitudes,NumberOfTimesPresented,Category, StimulusNumber,arousal_rating, valence_rating)

# get old ID structure back, if needed 
dfEMG$ID <- paste(dfEMG$project ,dfEMG$ID ,  sep = "_")
dfEMG$project = NULL 
emg_rat = dfEMG
# new: n = 401
```

```{r rating-stributions}
hist(as.numeric(dfEMG$arousal_rating))
hist(as.numeric(dfEMG$valence_rating))
```


# Outline  
## *RSA from Ventura-Bort et al., 2022:*, data from Koppold et al., 2023
## **Affective Startle Modulation Task**
### STR Based on T Amplitudes
### Model Testing of Valence: Nearest Neighborhood, Anna Karenina (AK) and inverted AK  
### Model Testing Beyond Valence

##  **Startle based on T Amplitudes** 
```{r, readRDS myData2,include=FALSE }
#load the data
# if (loadData==0){
# load("LETOS_r_STR_pic_sou_ima_sortVal.RData") 
# STR_RSM<-LETOS_r_STR_pic_sou_ima_sortVal
# #------------------------
# SoundSTRVal<-STR_RSM  %>%
#   filter(Task=="2")
# SoundSTRVal<-SoundSTRVal%>%droplevels()
# SoundSTRVal$Category<-ifelse(SoundSTRVal$trial_type==8,"Pl",
#                            ifelse(SoundSTRVal$trial_type==10,"Un","Ne"))
# SoundSTRValMod<-SoundSTRVal%>%
#   select(Vp,Category, Val, T_scores) 

#Matrix should contain VP, Behavioral Variable (e.g., Aro), 
# variable coding the sorting (sortVal), Variables for the vector (variables containing STR)
dfEMG <- dfEMG %>% 
       rename("Vp" = "ID",
              "T_scores" = "TAmplitudes",
              "Aro" = "arousal_rating",
              "Val" = "valence_rating",
              "trial_order"= "StimulusNumber")

## sort  participant, and valence 
dfEMG <- dfEMG%>% 
  arrange_at ("Val")%>%
  arrange_at("Vp")


#create a new variable that "counts the trials based on their valence rating
j<-1
dfEMG$sortVal<-0
for (i in 1:nrow(dfEMG)){
  if (i< nrow(dfEMG)){
    
    if(dfEMG$Vp[i]==  dfEMG$Vp[i+1]){
      dfEMG$sortVal[i]<-j
      j <- j+1
    }
    
    else{
      dfEMG$sortVal[i]<-j
      j <-1
    }
  }
  else {dfEMG$sortVal[i]<-j
  }
}


SoundSTRVal<-dfEMG%>%
  select(Vp,sortVal, T_scores) 

#----------------- DEFINE PARAMETERS FOR RUNING  for STR and Valence
#rename to favor the function. 
SoundSTRVal<-SoundSTRVal%>%
  rename(sort= sortVal)
MaxValue<- max(SoundSTRVal$T_scores, na.rm=T)

OriginalData<-SoundSTRVal
nVariables<-36 # this variable defines the number of cells e.g., Soundtures presented
CharContainingNumberFromVector<-4 #Character containing number from variables coding vector.
#e.g., STR1, STR2, STR3... the character is 4: 1, 2, 3...
### Select the variables needed for the loop: VP, Variable sorting, Vector values
VariableType<-"STR"
sortType<- "Valence"


RSMSingleValue(SoundSTRVal,nVariables,CharContainingNumberFromVector,VariableType,sortType,MaxValue)

```

```{r}

STR_Valence_RSM
```

## *Models of Valence*  

### the RSMs of SCR will be tested against two models: 
the Nearest Neighborhood model which assumes that the closer trials are in valence, the more similar they are  
from the Anna Karenina (AK) model which assumes that trials with high valence will be more similar to each other than those rates as low arousal,
we will derive the inverted model (Inverted AK Model), which assumes that lower values of valence are similar to each other, but higher values are more dissimilar
```{r, readRDS myData3,include=FALSE }
#Create Matrix based on single BEHAVIORAL
STR_RSM = dfEMG
loadData == 0


#if (loadData == 0) {
  SoundBehaValsV <- STR_RSM  %>%
    dplyr::select(Vp, sortVal, Val)
  
  
  SoundBehaValsV <- SoundBehaValsV %>%
    rename(Behavioral = Val) %>%
    rename(sort = sortVal)
  
  
  SoundBehaValsV <- SoundBehaValsV %>% droplevels()
  # OriginalData<-SoundBehaValsV
  SoundBehaValsV$Behavioral<-as.numeric(SoundBehaValsV$Behavioral)
  MaxValue <- max(SoundBehaValsV$Behavioral, na.rm = T)
  
  nVariables <-
    36 # this variable defines the number of cells e.g., Soundtures presented
  CharContainingNumberFromVector <-
    3 #Character containing number from variables coding vector.
  #e.g., STR1, STR2, STR3... the character is 4: 1, 2, 3...
  ### Select the variables needed for the loop: VP, Variable sorting, Vector values
  VariableType <- "Behav_Single_STR"
  sortType <- "Valence"
  
  RSMSingleValue(
    SoundBehaValsV,
    nVariables,
    CharContainingNumberFromVector,
    VariableType,
    sortType,
    MaxValue
  )
  
  VariableType <- "Behav_Single_STR_AK"
  sortType <- "Valence"
  
  RSMSingleValueAK(
    SoundBehaValsV,
    nVariables,
    CharContainingNumberFromVector,
    VariableType,
    sortType,
    MaxValue
  )
  
  VariableType <- "Behav_Single_STR_invAK"
  sortType <- "Valence"
  
  RSMSingleValueinvAK(
    SoundBehaValsV,
    nVariables,
    CharContainingNumberFromVector,
    VariableType,
    sortType,
    MaxValue
  )
  
#}
```

```{r}
Behav_Single_STR_Valence_RSM
Behav_Single_STR_AK_Valence_RSM
Behav_Single_STR_invAK_Valence_RSM
```

### Model tested againt each Model 
```{r, readRDS myData41,include=FALSE }
#if (loadData==0) {
  Model <- "ValRatingsNN"
  Data <- "STRSingle"
  
  RSMIndividual(STR_corr_prep_all,
                Behav_Single_STR_corr_prep_all,
                Model,
                Data)
  
  
  Model <- "ValRatingsAK"
  Data <- "STRSingle"
  RSMIndividual(STR_corr_prep_all,
                Behav_Single_STR_AK_corr_prep_all,
                Model,
                Data)
  
  
  
  Model <- "ValRatingsinvAK"
  Data <- "STRSingle"
  RSMIndividual(STR_corr_prep_all,
                Behav_Single_STR_invAK_corr_prep_all,
                Model,
                Data)
  
  
  #
  seedPer <- 55
  nPermutations <- 10000
  VariableOriginal <- "STR"
  VariableModel <- "ValRatingsNN"
  
  PermutationTest(
    STR_corr_prep_all,
    Behav_Single_STR_corr_prep_all,
    VariableOriginal,
    VariableModel,
    nPermutations,
    seedPer
  )
  
  #AK
  seedPer <- 55
  nPermutations <- 10000
  VariableOriginal <- "STR"
  VariableModel <- "ValRatingsAK"
  PermutationTest(
    STR_corr_prep_all,
    Behav_Single_STR_AK_corr_prep_all,
    VariableOriginal,
    VariableModel,
    nPermutations,
    seedPer
  )
  
  #invAK
  seedPer <- 55
  nPermutations <- 10000
  VariableOriginal <- "STR"
  VariableModel <- "ValRatingsinvAK"
  PermutationTest(
    STR_corr_prep_all,
    Behav_Single_STR_invAK_corr_prep_all,
    VariableOriginal,
    VariableModel,
    nPermutations,
    seedPer
  )
#}

```


```{r}
ValRatingsNN_STRSingle_IndividualPlot
          ValRatingsAK_STRSingle_IndividualPlot
          ValRatingsinvAK_STRSingle_IndividualPlot



ggarrange( STR_ValRatingsNN_PermOutput[["Output"]][["PermutationPlot"]],
           STR_ValRatingsAK_PermOutput[["Output"]][["PermutationPlot"]],
           STR_ValRatingsinvAK_PermOutput[["Output"]][["PermutationPlot"]],
           labels = c("NN", "AK", "invAK" ),   hjust=-2,
           ncol = 1, nrow =3, widths = c(10,10))
```


### Test the unique contribution of each model (i.e., NN and AK)
#### **VECTOR**
```{r, readRDS myData4,include=FALSE }
#------------ VECtOR------------------
#if (loadData==0){
  
  #PermutationwithRegression
  OriginalData<- STR_corr_prep_all
  ModelData1<-Behav_Single_STR_AK_corr_prep_all
  ModelData2<- Behav_Single_STR_corr_prep_all
  VariableOriginal<-"STR_Single"
  VariableModel1<- "ValRatings_AK"
  VariableModel2<- "ValRatings_NN"
  seedPer<-49
  nPermutations<-10000
  PlotRSMReg<-1
  Category = "Trials"
  
  PermutationTestRegModels(OriginalData,ModelData1,
                       ModelData2,VariableOriginal,VariableModel1,VariableModel2,Category,
                           nPermutations,seedPer,PlotRSMReg)
  
  
  #Individual Data
  RSMIndividualRegression(OriginalData,ModelData1,ModelData2,VariableOriginal,VariableModel1,VariableModel2) 
#}
```

```{r}
ggarrange(STR_Single_ValRatings_AK_ValRatings_NN_IndividualPlotRegression[[1]],
          STR_Single_ValRatings_AK_ValRatings_NN_IndividualPlotRegression[[2]],
          labels = c("", "" ),   vjust=-7,
          ncol = 2, nrow =1, widths = c(5,5))


ggarrange(STR_Single_ValRatings_AK_ValRatings_NN_PermOutputRegr[["Ouput"]][["RSMPlotRegressionM1"]],
          STR_Single_ValRatings_AK_ValRatings_NN_PermOutputRegr[["Ouput"]][["RSMPlotRegressionM2"]],
          labels = c("", "" ),   vjust=-7,
          ncol = 2, nrow =1, widths = c(5,5))

ggarrange( STR_Single_ValRatings_AK_ValRatings_NN_PermOutputRegr[["Ouput"]][["PermutationPlotM1"]],
           STR_Single_ValRatings_AK_ValRatings_NN_PermOutputRegr[["Ouput"]][["PermutationPlotM2"]],
           labels = c("iAK", "NN"),   vjust=(12),
           ncol = 1, nrow =2, widths = c(5,5))
```


### Relationship between Similarity measures of the NN and invAK Model  
```{r, readRDS myData6,include=FALSE }
#if (loadData==0){
  #VECTOR
  STRSimComparison<-inner_join(ValRatingsAK_STRSingle_tableCorrelation,
                               ValRatingsNN_STRSingle_tableCorrelation,
                               by = "VP", suffix = c("AK","NN"))
  
  cor.testSTRSimCom<-cor.test(STRSimComparison$CorrelationAK,STRSimComparison$CorrelationNN)
  
  p<- ggplot(STRSimComparison, aes(x=CorrelationAK, y=CorrelationNN)) +
    geom_point(shape=21, color = "black",fill="gray75", size=5)+
    theme(legend.position="none")+
    stat_smooth(method = "lm",
                formula = y ~ x,
                geom = "smooth", color = "red")+
    theme_classic()+
    stat_cor(method = "pearson")+
    ggtitle("SCR Vector")
  
  STRCorrModComp<- ggMarginal(p ,type="histogram", fill = "slateblue", xparams = list(  bins=100))
  
  
#} 
```

```{r}
STRCorrModComp
```
### Plot individual participants as example:   

#### High in AK and and in NN Model
``` {r}
#Plot VP 
#-------------- Plot RSM Matrix
dataOriginal<-STR_corr_prep_all#data coming up from RSM functions it should contain the variable mean_all
mypalette<- numeric()#colors
minimum<-numeric()#scale
maximum<-numeric()# scale
Category<- "trials" # VP or trials
Participant<- "VP3Z02_1" # factor() #if individual participants are to be selected,
sortType<- "Valence" #variable to sort on
PlotMatrix(dataOriginal, minimum,maximum,Category,sortType,Participant, mypalette)

```


#### High in invAK and close to 0 in NN Model  
``` {r}
#Plot VP 
dataOriginal<-STR_corr_prep_all#data coming up from RSM functions it should contain the variable mean_all
mypalette<- numeric()#colors
minimum<-numeric()#scale
maximum<-numeric()# scale
Category<- "trials" # VP or trials
Participant<- "VP3Z02_68" # factor() #if individual participants are to be selected,
sortType<- "Valence" #variable to sort on
PlotMatrix(dataOriginal, minimum,maximum,Category,sortType,Participant, mypalette)
```


#### Low in invAK and moderate in NN Model
``` {r}
#Plot VP 
dataOriginal<-STR_corr_prep_all#data coming up from RSM functions it should contain the variable mean_all
mypalette<- numeric()#colors
minimum<-numeric()#scale
maximum<-numeric()# scale
Category<- "trials" # VP or trials
Participant<- "VP3Z02_18" # factor() #if individual participants are to be selected,
sortType<- "Valence" #variable to sort on
PlotMatrix(dataOriginal, minimum,maximum,Category,sortType,Participant, mypalette)

```

##  **Model Testing Beyond Valence Is the AK the best fitting model?**  
### Model Time  
```{r, readRDS myData7,include=FALSE }
#if (loadData==0){
  #----------- MODEL TIME-----------------------
  #Create Matrix based on single BEHAVIORAL
  SoundSTRValsVTime<-STR_RSM  %>%
 # filter(Task==2)%>%
  dplyr::select(Vp, sortVal,trial_order)%>%droplevels()
SoundSTRValsVTime<-SoundSTRValsVTime%>%
  rename(Behavioral= trial_order)%>%
  rename(sort= sortVal)
SoundSTRValsVTime$Behavioral<-as.numeric(SoundSTRValsVTime$Behavioral)
  # OriginalData<-SoundEdaArosV
  MaxValue<- max(SoundSTRValsVTime$Behavioral, na.rm=T)
  
  nVariables<-36 # this variable defines the number of cells e.g., Soundtures presented
  CharContainingNumberFromVector<-3 #Character containing number from variables coding vector.
  #e.g., EDA1, EDA2, EDA3... the character is 4: 1, 2, 3...
  ### Select the variables needed for the loop: VP, Variable sorting, Vector values
  VariableType<-"Behav_SingleTimeSortedbyValence"
  sortType<- "TimeSortedbyValence"
  
  RSMSingleValue(SoundSTRValsVTime,nVariables,CharContainingNumberFromVector,VariableType,sortType, MaxValue)
  
  Model<-"STR"
  Data<- "TimeSortedByValence"
  RSMIndividual(STR_corr_prep_all,Behav_SingleTimeSortedbyValence_corr_prep_all,Model,Data)
  
  
#}
```


```{r}
STR_TimeSortedByValence_IndividualPlot
```

### Test whether the AK model is contributing beyond time  
```{r, readRDS myData8,include=FALSE }
#if (loadData==0){
  # Individual Regression
  OriginalData<- STR_corr_prep_all
  ModelData1<-Behav_Single_STR_AK_corr_prep_all
  ModelData2<- Behav_SingleTimeSortedbyValence_corr_prep_all
  VariableOriginal<-"STR"
  VariableModel1<- "Val_AK"
  VariableModel2<- "Time_NN"
  
  RSMIndividualRegression(OriginalData,ModelData1,ModelData2,VariableOriginal,VariableModel1,VariableModel2) 
  
  #Amplitude
  SingleSimComparisonTime<-inner_join(ValRatingsAK_STRSingle_tableCorrelation,
                                      STR_TimeSortedByValence_tableCorrelation,
                                      by = "VP", suffix = c("AK","Time"))
  
  cor.testSingSimComTime<-cor.test(SingleSimComparisonTime$CorrelationAK,SingleSimComparisonTime$CorrelationTime)
  
  p<- ggplot(SingleSimComparisonTime, aes(x=CorrelationAK, y=CorrelationTime)) +
    geom_point(shape=21, color = "black",fill="gray75", size=5)+
    theme(legend.position="none")+
    stat_smooth(method = "lm",
                formula = y ~ x,
                geom = "smooth", color = "red")+
    theme_classic()+
    stat_cor(method = "pearson")+
    ggtitle("SCR Single")
  
  SCRSingleCorrModCompTime<- ggMarginal(p ,type="histogram", fill = "slateblue", xparams = list(  bins=100))
#}
# save.image("RSA_SCR_Sound_VB22_Def.RData")

```

```{r}
SCRSingleCorrModCompTime

ggarrange(STR_Val_AK_Time_NN_IndividualPlotRegression[[1]],
          STR_Val_AK_Time_NN_IndividualPlotRegression[[2]],
          labels = c("", "" ),   vjust=-7,
          ncol = 2, nrow =1, widths = c(5,5))



```


### Model Category (Pleasant, Unpleasant, Neutral)  
```{r, readRDS myData88,include=FALSE }
#if (loadData==0){
  #----------------------------- MODEL Category --------------------------------------
 SoundSTRValsVCat<-STR_RSM  

  # SoundSTRValsVCat$Category<-ifelse(SoundSTRValsVCat$trial_type==8,"Pl",
  #                                  ifelse(SoundSTRValsVCat$trial_type==10,"Un","Ne")) %>%
 
   SoundSTRValsVCat<-SoundSTRValsVCat%>%
     dplyr::select(Vp, sortVal,Category) %>% droplevels()

   
  SoundSTRValsVCat<-SoundSTRValsVCat%>%
    rename(Behavioral= Category)%>%
    rename(sort= sortVal)
  # OriginalData<-SoundEdaArosV
  MaxValue<- 1
  nVariables<-36 # this variable defines the number of cells e.g., Soundtures presented
  CharContainingNumberFromVector<-3 #Character containing number from variables coding vector.
  #e.g., EDA1, EDA2, EDA3... the character is 4: 1, 2, 3...
  ### Select the variables needed for the loop: VP, Variable sorting, Vector values
  VariableType<-"Behav_SingleCategorySortedbyValence"
  sortType<- "CategorySortedbyValence"
  
  RSMSingleValueFactor(SoundSTRValsVCat,nVariables,CharContainingNumberFromVector,VariableType,sortType, MaxValue)
  
  
  Model<-"STRSingle"
  Data<- "Categorysortedbyvalence"
  RSMIndividual(STR_corr_prep_all,Behav_SingleCategorySortedbyValence_corr_prep_all,Model,Data)
  
#}
# save.image("RSA_SCR_Sound_VB22_Def.RData")

```

```{r}
STRSingle_Categorysortedbyvalence_IndividualPlot
```


### Test whether the AK model is contributing beyond Category
```{r, readRDS myData10,include=FALSE }
#if (loadData==0){
  # Individual Regression
  OriginalData<- STR_corr_prep_all
  ModelData1<-Behav_Single_STR_AK_corr_prep_all
  ModelData2<- Behav_SingleCategorySortedbyValence_corr_prep_all
  VariableOriginal<-"STRSingle"
  VariableModel1<- "Valence_AK"
  VariableModel2<- "Category_Factor"
  
  RSMIndividualRegression(OriginalData,ModelData1,ModelData2,VariableOriginal,VariableModel1,VariableModel2) 
  
  #Amplitude
  SingleSimComparisonCat<-inner_join(ValRatingsAK_STRSingle_tableCorrelation,
                                     STRSingle_Categorysortedbyvalence_tableCorrelation,,
                                     by = "VP", suffix = c("AK","Cat"))
  
  cor.testSingSimComCat<-cor.test(SingleSimComparisonCat$CorrelationAK,SingleSimComparisonCat$CorrelationCat)
  
  p<- ggplot(SingleSimComparisonCat, aes(x=CorrelationAK, y=CorrelationCat)) +
    geom_point(shape=21, color = "black",fill="gray75", size=5)+
    theme(legend.position="none")+
    stat_smooth(method = "lm",
                formula = y ~ x,
                geom = "smooth", color = "red")+
    theme_classic()+
    stat_cor(method = "pearson")+
    ggtitle("SCR Single")
  
  SCRSingleCorrModCompCat<- ggMarginal(p ,type="histogram", fill = "slateblue", xparams = list(  bins=100))
#}
# save.image("RSA_SCR_Sound_VB22_Def.RData")

```

```{r}
SCRSingleCorrModCompCat

ggarrange(STRSingle_Valence_AK_Category_Factor_IndividualPlotRegression[[1]],
          STRSingle_Valence_AK_Category_Factor_IndividualPlotRegression[[2]],
          labels = c("", "" ),   vjust=-7,
          ncol = 2, nrow =1, widths = c(5,5))



```



### Model Valence
```{r, readRDS myData9,include=FALSE }
#if (loadData==0){
  #----------------------------- MODEL Arousal --------------------------------------
  SoundBehavArosVVal<-STR_RSM  %>%
    dplyr::select(Vp, sortVal,Aro)
  SoundBehavArosVVal<-SoundBehavArosVVal%>%
    rename(Behavioral= Aro)%>%
    rename(sort= sortVal)%>%droplevels()
  # OriginalData<-SoundEdaArosV
SoundBehavArosVVal$Behavioral = as.numeric(SoundBehavArosVVal$Behavioral)
  MaxValue<- max(SoundBehavArosVVal$Behavioral, na.rm=T)
  
  nVariables<-36 # this variable defines the number of cells e.g., Soundtures presented
  CharContainingNumberFromVector<-3 #Character containing number from variables coding vector.
  #e.g., EDA1, EDA2, EDA3... the character is 4: 1, 2, 3...
  ### Select the variables needed for the loop: VP, Variable sorting, Vector values
  VariableType<-"Behav_SingleAroSortedbyValence"
  sortType<- "AroSortedbyValence"
  
  RSMSingleValue(SoundBehavArosVVal,nVariables,CharContainingNumberFromVector,VariableType,sortType, MaxValue)
  
  Model<-"STRSingle"
  Data<- "AroSortedByValence"
  RSMIndividual(STR_corr_prep_all,Behav_SingleAroSortedbyValence_corr_prep_all,Model,Data)
  
  
#}
# save.image("RSA_SCR_Sound_VB22_Def.RData")

```

```{r}
STRSingle_AroSortedByValence_IndividualPlot
```

### Test whether the AK model is contributing beyond Valence
```{r, readRDS myData11,include=FALSE }
#if (loadData==0){
  # Individual Regression
  OriginalData<- STR_corr_prep_all
  ModelData1<-Behav_Single_STR_AK_corr_prep_all
  ModelData2<- Behav_SingleAroSortedbyValence_corr_prep_all
  VariableOriginal<-"STR"
  VariableModel1<- "Valence_AK"
  VariableModel2<- "Arousal_NN"
  
  RSMIndividualRegression(OriginalData,ModelData1,ModelData2,VariableOriginal,VariableModel1,VariableModel2) 
  
  #Amplitude
  SingleSimComparisonAro<-inner_join(ValRatingsAK_STRSingle_tableCorrelation,
                                     STRSingle_AroSortedByValence_tableCorrelation,
                                     by = "VP", suffix = c("AK","Aro"))
  
  cor.testSingSimComAro<-cor.test(SingleSimComparisonAro$CorrelationAK,SingleSimComparisonAro$CorrelationAro)
  
  p<- ggplot(SingleSimComparisonAro, aes(x=CorrelationAK, y=CorrelationAro)) +
    geom_point(shape=21, color = "black",fill="gray75", size=5)+
    theme(legend.position="none")+
    stat_smooth(method = "lm",
                formula = y ~ x,
                geom = "smooth", color = "red")+
    theme_classic()+
    stat_cor(method = "pearson")+
    ggtitle("SCR Single")
  
  SCRSingleCorrModCompVal<- ggMarginal(p ,type="histogram", fill = "slateblue", xparams = list(  bins=100))
#}
# save.image("RSA_SCR_Sound_VB22_Def.RData")

```

```{r}
SCRSingleCorrModCompVal

ggarrange(STR_Valence_AK_Arousal_NN_IndividualPlotRegression[[1]],
          STR_Valence_AK_Arousal_NN_IndividualPlotRegression[[2]],
          labels = c("", "" ),   vjust=-7,
          ncol = 2, nrow =1, widths = c(5,5))
```

### Model Category based on Arousal (Arousing, non-arousing images)
```{r, readRDS myData12,include=FALSE }
#if (loadData==0){
  #----------------------------- MODEL Category 2 (arousing non-arousing) --------------------------------------
 SoundSTRValsVCat<-STR_RSM 
  SoundSTRValsVCat$Category2<-ifelse(SoundSTRValsVCat$Category=="neutral","No","Ye")
  SoundEdaArosVCat2<-SoundSTRValsVCat  %>%
    dplyr::select(Vp, sortVal,Category2) # sort changed to sortVal by alina
  SoundEdaArosVCat2<-SoundEdaArosVCat2%>%
    rename(Behavioral= Category2,
           sort = sortVal)
  
  # OriginalData<-SoundEdaArosV
  MaxValue<- 1
  nVariables<-36 # this variable defines the number of cells e.g., Soundtures presented
  CharContainingNumberFromVector<-3 #Character containing number from variables coding vector.
  #e.g., EDA1, EDA2, EDA3... the character is 4: 1, 2, 3...
  ### Select the variables needed for the loop: VP, Variable sorting, Vector values
  VariableType<-"Behav_SingleCategory2SortedbyValence"
  sortType<- "CategorySortedbyValence"
  
 RSMSingleValueFactor(SoundEdaArosVCat2,nVariables,CharContainingNumberFromVector,VariableType,sortType, MaxValue)
  
  Model<-"STR"
  Data<- "Category2SortedbyValence"
  RSMIndividual(STR_corr_prep_all,Behav_SingleCategory2SortedbyValence_corr_prep_all,Model,Data)
  
#}
# save.image("RSA_SCR_Sound_VB22_Def.RData")

```


```{r}
STR_Category2SortedbyValence_IndividualPlot
```
### Test whether the AK model is contributing beyond Category 2
```{r, readRDS myData13,include=FALSE }
#if (loadData==0){
  # Individual Regression
  OriginalData<- STR_corr_prep_all
  ModelData1<-Behav_Single_STR_AK_corr_prep_all
  ModelData2<- Behav_SingleCategory2SortedbyValence_corr_prep_all
  VariableOriginal<-"STR"
  VariableModel1<- "Valence_AK"
  VariableModel2<- "Category2_Factor"
  
  RSMIndividualRegression(OriginalData,ModelData1,ModelData2,VariableOriginal,VariableModel1,VariableModel2) 
  
  #Amplitude
  SingleSimComparisonCat2<-inner_join(ValRatingsAK_STRSingle_tableCorrelation,
                                      STR_Category2SortedbyValence_tableCorrelation,
                                      by = "VP", suffix = c("AK","Cat2"))
  
cor.testSingSimComCat2<-cor.test(SingleSimComparisonCat2$CorrelationAK,SingleSimComparisonCat2$CorrelationCat2)
  
  p<- ggplot(SingleSimComparisonCat2, aes(x=CorrelationAK, y=CorrelationCat2)) +
    geom_point(shape=21, color = "black",fill="gray75", size=5)+
    theme(legend.position="none")+
    stat_smooth(method = "lm",
                formula = y ~ x,
                geom = "smooth", color = "red")+
    theme_classic()+
    stat_cor(method = "pearson")+
    ggtitle("SCR Single")
  
  SCRSingleCorrModCompCat2<- ggMarginal(p ,type="histogram", fill = "slateblue", xparams = list(  bins=100))
#}

```

```{r}
SCRSingleCorrModCompCat2

ggarrange(STR_Valence_AK_Category2_Factor_IndividualPlotRegression[[1]],
          STR_Valence_AK_Category2_Factor_IndividualPlotRegression[[2]],
          labels = c("", "" ),   vjust=-7,
          ncol = 2, nrow =1, widths = c(5,5))
save.image("RSA_STR_Sound_VB22_Def.RData")

```


```{r rigdge-plot}
library(ggridges) # ridgeline plot
library(tidyr) # long format
library(colorBlindness)
library(RColorBrewer)
#install.packages("cols4all", dependencies = TRUE)
#library(cols4all)

long_data <- gather(SingleSimComparisonCat2, key = "model", value = "Correlation", 2:3)
ggplot(long_data, aes(x=Correlation, y=model))  + geom_density_ridges()

### single model alternative based on RSM data 
#STR_VariableModel1_VariableModel2_tableRegression = tableCorrelation
# long_data2 <- gather(STR_VariableModel1_VariableModel2_tableRegression, key = "model", value = "Similarity", 2:3)
# ggplot(long_data2, aes(x=Similarity, y=model))  + geom_density_ridges()+
#   scale_y_discrete(labels = c(VariableModel1, VariableModel2))


### all models
# test = cbind(STR_Val_AK_Time_NN_tableRegression,
 # STR_Valence_AK_Arousal_NN_tableRegression,
# STR_Valence_AK_Category2_Factor_tableRegression, 
# STR_Single_ValRatings_AK_ValRatings_NN_tableRegression,
# STRSingle_Valence_AK_Category_Factor_tableRegression)

# test2 = test[-c(4,7,10,13)]

test = cbind(STR_Val_AK_Time_NN_tableRegression,
        STRSingle_Valence_AK_Category_Factor_tableRegression,
        STR_Valence_AK_Category2_Factor_tableRegression, 
        STR_Valence_AK_Arousal_NN_tableRegression)
#test2 = test[c(1,3,6,9,12)]#
test2 = test[c(1,2,5,8, 11 )]
names(test2)<-c("VP", "Time", "Cat", "Cat2", "Arousal")

long_data2 <- gather(test2, key = "regressor", value = "rho value", 2:5)
ggplot(long_data2, aes(x= `rho value`, y=regressor, fill = regressor))  + geom_density_ridges()+
  geom_density_ridges(quantile_lines=TRUE,
                      quantile_fun=function(x,...)mean(x), color = "white") +
    scale_fill_brewer(palette = 4) +
  theme_ridges() + theme(legend.position = "none")+
  geom_vline(xintercept = 0, color = "red",size = 1.5, linetype = "dashed")

# colorblind friendly
cols = c("#E69F00"  ,   "#004949"  ,   "#009292" ,    "#FF6DB6"    , "#FFB6DB" ,    "#490092"  ,   "#006DDB" ,
    "#B66DFF"  ,   "#6DB6FF"   ,  "#B6DBFF")
ggplot(long_data2, aes(x= `rho value`, y=regressor, fill = regressor))  + geom_density_ridges()+  geom_density_ridges(quantile_lines=TRUE,
                      quantile_fun=function(x,...)mean(x), color = "black") +
  theme_ridges() + theme(legend.position = "none")+
    scale_fill_manual(values = cols)+
  geom_vline(xintercept = 0, color = "red", size = 1.5, linetype = "dashed")

#displayAvailablePalette(color="white")

```

```{r dendogram}
library(dendextend)
library(circlize)

my_data = Behav_Single_STR_AK_corr_prep_all
# Select the columns for clustering
data_for_clustering <- my_data[, c("var1", "var2", "mean_all")]

# Perform hierarchical clustering
dist_matrix <- dist(data_for_clustering)  # Calculate the distance matrix
hc <- hclust(dist_matrix)  # Perform hierarchical clustering

# Plot the dendrogram
#plot(hc, main = "Dendrogram of Clustering")

# Convert hierarchical clustering object to a dendrogram
dendro <- as.dendrogram(hc)

dendro <- dendro %>% 
  color_branches(k=4) %>% 
  color_labels

plot(dendro)

# Create a circular dendrogram
# plot the radial plot
par(mar = rep(0,4))
# circlize_dendrogram(dend, dend_track_height = 0.8) 
circlize_dendrogram(dendro, labels_track_height = NA, dend_track_height = .4) 
```

